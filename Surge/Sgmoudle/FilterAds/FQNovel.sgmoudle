#!name=番茄去广告
#!desc=集成 Lookahead 前瞻规则与常规 DOMAIN/URL-REGEX 拦截，彻底屏蔽番茄小说开屏、章末、贴片、听书页广告及悬浮福利标签，保留封面/头像和字节系核心功能。
#!author=可莉🅥 & zqzess & ChatGPT
#!icon=https://raw.githubusercontent.com/luestr/IconResource/main/App_icon/120px/DragonRead.png
#!category=广告屏蔽

[Rule]
# —— Lookahead 复合条件 （由 Loon AND 规则转换） ——  
URL-REGEX,(?i)(?=.*-ad-)(?=.*\.byteimg\.com).+,REJECT  
URL-REGEX,(?i)(?=.*-ttam-)(?=.*\.ibyteimg\.com).+,REJECT  
URL-REGEX,(?i)(?=.*ssdk-)(?=.*\.pangle\.io).+,REJECT  
URL-REGEX,(?i)(?=.*pangolin)(?=.*\.sgsnssdk\.com).+,REJECT  
URL-REGEX,(?i)(?=.*\blf)(?=.*-short\.bytetos\.com).+,REJECT  
URL-REGEX,(?i)(?=.*\bv)(?=.*-be-pack\.pglstatp-toutiao\.com).+,REJECT  
URL-REGEX,(?i)(?=.*\bsf)(?=.*-be-pack\.pglstatp-toutiao\.com).+,REJECT  
URL-REGEX,(?i)(?=.*\bs)(?=.*-fe-scm\.pglstatp-toutiao\.com).+,REJECT  
URL-REGEX,(?i)(?=.*\bsf)(?=.*-ttcdn-tos\.pstatp\.com).+,REJECT  
URL-REGEX,(?i)(?=.*\bsf)(?=.*-fe-tos\.pglstatp-toutiao\.com).+,REJECT  
URL-REGEX,(?i)(?=.*\bsf)(?=.*-static\.i18n-pglstatp\.com).+,REJECT  
URL-REGEX,(?i)(?=.*\bif)(?=.*-cdn-tos\.bytescm\.com).+,REJECT  
URL-REGEX,(?i)(?=.*\bif)(?=.*-analytics\.bytescm\.com).+,REJECT  
URL-REGEX,(?i)(?=.*\blf)(?=.*-analytics\.bytescm\.com).+,REJECT  
URL-REGEX,(?i)(?=.*ads)(?=.*normal)(?=.*zijieapi\.com).+,REJECT  
URL-REGEX,(?i)(?=.*api)(?=.*-access-)(?=.*\.pangle\.io).+,REJECT  
URL-REGEX,(?i)(?=.*api)(?=.*-log-)(?=.*\.pangle\.io).+,REJECT  
URL-REGEX,(?i)(?=.*api)(?=.*-dual-event-)(?=.*\.pangle\.io).+,REJECT  
URL-REGEX,(?i)(?=.*api)(?=.*pangolin)(?=.*\.sgsnssdk\.com).+,REJECT  
URL-REGEX,(?i)(?=.*ads)(?=.*-normal-lq)(?=.*zijieapi\.com).+,REJECT  

# —— 特殊路径拦截 ——  
URL-REGEX,^http://p\d+-be-pack-sign\.pglstatp-toutiao\.com/(ad-app-package|web\.business\.image)/,REJECT  

# —— 常规 DOMAIN 拦截 ——  
DOMAIN,mon.zijieapi.com,REJECT  
DOMAIN,lf-ad-ies.bytecdn.cn,REJECT  
DOMAIN,i.snssdk.com,REJECT  
DOMAIN,is.snssdk.com,REJECT  # 已保留直连/可调整为 DIRECT  
DOMAIN,bds.snssdk.com,REJECT  
DOMAIN,dm.bytedance.com,REJECT  
DOMAIN,dm.pstatp.com,REJECT  
DOMAIN,dm.toutiao.com,REJECT  
DOMAIN,log.snssdk.com,REJECT  
DOMAIN,s3a.pstatp.com,REJECT  
DOMAIN,sdfp.snssdk.com,REJECT  
DOMAIN,tosv.boe.byted.org,REJECT  
DOMAIN,tosv.byted.org,REJECT  
DOMAIN,extlog.snssdk.com,REJECT  
DOMAIN,mssdk-bu.bytedance.com,REJECT  
DOMAIN,toblog.ctobsnssdk.com,REJECT  
DOMAIN,mssdk.volces.com,REJECT  
DOMAIN,pangolin.snssdk.com,REJECT  
DOMAIN,gromore.pangolin-sdk-toutiao.com,REJECT  
DOMAIN,ether-pack.pangolin-sdk-toutiao.com,REJECT  
DOMAIN-KEYWORD,-ad-sign.byteimg.com,REJECT  
DOMAIN-KEYWORD,api-access.pangolin-sdk-toutiao,REJECT  
DOMAIN-KEYWORD,log-api.pangolin-sdk-toutiao,REJECT  
DOMAIN-KEYWORD,-ad.byteoversea.com,REJECT  
DOMAIN-KEYWORD,video-cn.snssdk.com,REJECT  
DOMAIN-KEYWORD,asiad.byteactivity,REJECT  

# —— Surge 核心视频 & 图像广告 ——  
DOMAIN-REGEX,^v\d+-(reading-video|novelapp)\.fqnovelvod\.com$,REJECT  
URL-REGEX,^https?://v\d+-(reading-video|novelapp)\.fqnovelvod\.com/.+\.mp4,REJECT  
DOMAIN,lf-reward-video.bytedcdn.com,REJECT  
DOMAIN,p3-ad-sign.byteimg.com,REJECT  
DOMAIN,p3-reading-sign.fqnovelpic.com,REJECT  
DOMAIN,lf3-reading.fqnovelpic.com,REJECT  
DOMAIN,lf-fe.fqnovelstatic.com,REJECT  
DOMAIN-KEYWORD,novel.byteimg.com,REJECT  
URL-REGEX,^https?://.+\.byteimg\.com/.+(ad|ad-img|ad-pattern).+\.jpeg,REJECT  
URL-REGEX,^https?://.+\.byteimg\.com/.+/ad-pattern/.+,REJECT  
URL-REGEX,^https?://.+\.fqnovelpic\.com/.+/ad/.+,REJECT  

# —— 广告接口 & 资源包 ——  
URL-REGEX,^http://sf3-be-pack\.pglstatp-toutiao\.com/obj/ad-app-package/,REJECT  
URL-REGEX,^https?://(api-access\.pangolin-sdk-toutiao(\d|-b)?|is\.snssdk)\.com/api/ad/union/sdk/(get_ads|stats|settings)/,REJECT  
URL-REGEX,^https?://.+\.(pglstatp-toutiao|pstatp)\.com/(obj|img)/(ad-app-package|ad|web\.business\.image)/.+,REJECT  

# —— 电商 & 分析 ——  
DOMAIN,bsync3-normal-lf.zijieapi.com,REJECT  
DOMAIN,mon11-misc-lf.fqnovel.com,REJECT  
DOMAIN,frontier100-toutiao-lf.fqnovel.com,REJECT  
DOMAIN,rtlog5-applog-lf.fqnovel.com,REJECT  
DOMAIN,ecom3-normal-lf.ecombdapi.com,REJECT  
DOMAIN,ecom5-normal-lf.ecombdapi.com,REJECT  
DOMAIN,ec3-core-lf.ecombdapi.com,REJECT  
DOMAIN,ec5-core-lf.ecombdapi.com,REJECT  
DOMAIN,isaas5-normal-lf.ecombdapi.com,REJECT  
DOMAIN,api5-normal-lf.fqnovel.com,REJECT  
DOMAIN,api5-normal-sinfonlinec.fqnovel.com,REJECT  
DOMAIN,saveu5-normal-lf.zijieapi.com,REJECT  
DOMAIN,ads5-normal-lf.ecombdapi.com,REJECT  
DOMAIN,imapi5-oth-lf.zijieapi.com,REJECT  
DOMAIN,ma.zijieapi.com,REJECT  
DOMAIN,vas.snssdk.com,REJECT  
DOMAIN,effect.snssdk.com,REJECT  
DOMAIN,pitaya.bytedance.com,REJECT  
DOMAIN-KEYWORD,zijieapi.com,REJECT  

# —— 直播流 & 跨平台 ——  
DOMAIN-KEYWORD,douyincdn.com,REJECT  
URL-REGEX,^http://pull-flv-l\d+\.douyincdn\.com/third/stream-.+\.flv,REJECT  
DOMAIN,webcast5-open-lf.douyin.com,REJECT  
DOMAIN,content-open.douyin.com,REJECT  
DOMAIN,p11-sign.douyinpic.com,REJECT  
DOMAIN,p26-sign.douyinpic.com,REJECT  
DOMAIN-KEYWORD,open.douyin.com,REJECT  

# —— 必要服务 ——  
DOMAIN,is.snssdk.com,DIRECT  
DOMAIN,i.snssdk.com,DIRECT  

[MITM]
hostname = %APPEND% \
  *.snssdk.com,*.pstatp.com,*.pglstatp-toutiao.com,*.byteimg.com, \
  *.zijieapi.com,*.pangle.io,*.ibyteimg.com
