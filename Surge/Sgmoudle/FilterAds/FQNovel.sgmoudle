#!name=番茄去广告
#!desc=集成 Lookahead 前瞻规则与常规 DOMAIN/URL-REGEX 拦截，彻底屏蔽番茄小说开屏、章末、贴片、听书页广告及悬浮福利标签，保留封面/头像和字节系核心功能。
#!author=ByteValley & ChatGPT
#!icon=https://raw.githubusercontent.com/luestr/IconResource/main/App_icon/120px/DragonRead.png
#!category=广告屏蔽

[Rule]
# —— 视频广告 ——  
AND, ((DOMAIN-KEYWORD, reading-video), (DOMAIN-SUFFIX, fqnovelvod.com)), REJECT  
URL-REGEX,^https?://v\d+-novelapp\.fqnovelvod\.com/.+/video/.+,REJECT  

# —— 图片广告 ——  
AND, ((DOMAIN-KEYWORD, ad-sign), (DOMAIN-SUFFIX, byteimg.com)), REJECT  
AND, ((DOMAIN-KEYWORD, reading-sign), (DOMAIN-SUFFIX, fqnovelpic.com)), REJECT  

# —— 激励／联盟接口广告 ——  
URL-REGEX,^https://(api-access\.pangolin-sdk-toutiao(\d|-b)?|is\.snssdk)\.com/api/ad/union/sdk/get_ads, DIRECT  
# （放行上面，再封下面这条以保证脚本执行）
URL-REGEX,^https?://.+\.pangolin-sdk-toutiao.*?/api/ad/union/sdk/(get_ads|stats|settings)/,REJECT  

# —— 其它已知广告子域 ——  
DOMAIN-REGEX,^[^.]+-cdn-tos\.bytegoofy\.com$,REJECT  
DOMAIN-REGEX,^[^.]+-misc-lf\.fqnovel\.com$,REJECT  
DOMAIN-REGEX,^[^.]+-webcast-gr-sourcecdn\.bytegecko\.com$,REJECT  
# 如果你还抓到别的漏网域，按上面格式再补一条就好  

# —— 业务接口放行 ——  
# （保留你之前放行签到、预约、催更的那些放行规则）
URL-REGEX,^https://api-access\.pangolin-sdk-toutiao.*

# —— IPv4 列表 ——
IP-CIDR,47.246.38.0/24,REJECT,no-resolve
IP-CIDR,49.71.37.101/32,REJECT,no-resolve
IP-CIDR,58.251.62.58/32,REJECT,no-resolve
IP-CIDR,61.170.77.65/32,REJECT,no-resolve
IP-CIDR,101.36.166.16/32,REJECT,no-resolve
IP-CIDR,103.136.221.67/32,REJECT,no-resolve
IP-CIDR,106.117.245.59/32,REJECT,no-resolve
IP-CIDR,107.155.58.209/32,REJECT,no-resolve
IP-CIDR,117.71.105.23/32,REJECT,no-resolve
IP-CIDR,117.92.229.188/32,REJECT,no-resolve
IP-CIDR,122.14.230.132/32,REJECT,no-resolve
IP-CIDR,155.102.4.4/32,REJECT,no-resolve
IP-CIDR,155.102.4.6/32,REJECT,no-resolve
IP-CIDR,155.102.4.142/32,REJECT,no-resolve
IP-CIDR,155.102.4.146/32,REJECT,no-resolve
IP-CIDR,163.181.35.180/32,REJECT,no-resolve
IP-CIDR,163.181.35.184/32,REJECT,no-resolve
IP-CIDR,163.181.35.203/32,REJECT,no-resolve
IP-CIDR,163.181.228.147/32,REJECT,no-resolve
IP-CIDR,180.96.2.114/32,REJECT,no-resolve
IP-CIDR,218.12.77.96/32,REJECT,no-resolve
IP-CIDR,218.94.207.205/32,REJECT,no-resolve

# —— IPv6 列表 ——
IP-CIDR,2404:2280:109:0:3::19/128,REJECT,no-resolve
IP-CIDR,2408:8756:2cff:e410:5e::10/128,REJECT,no-resolve
IP-CIDR,2408:871a:6010:302::1:13a/128,REJECT,no-resolve

[URL Rewrite]
^https://sf3-fe-tos\.pglstatp-toutiao\.com/obj/ad-pattern/ reject header
^https://sf3-fe-tos\.pglstatp-toutiao\.com/obj/ad-pattern/ reject
^https://lf-cdn-tos\.bytescm\.com/obj/static/ad/ reject
^https:\/\/tnc3-alisc1\.zijieapi\.com\/get_domains\/ reject

[MITM]
hostname = %APPEND% \
  *.snssdk.com,*.pstatp.com,*.pglstatp-toutiao.com,*.byteimg.com,*.zijieapi.com, \
  *.pangle.io,*.ibyteimg.com,*.pangolin-sdk-toutiao,*.fqnovelvod.com,*.fqnovelpic.com, \
  *.fqnovelstatic.com,*.ecombdapi.com,*.bytedcdn.com,*.douyincdn.com,*.douyin.com, \
  *.bytegecko.com,*.bytedance.com,gurd.snssdk.com,adim.pinduoduo.com

