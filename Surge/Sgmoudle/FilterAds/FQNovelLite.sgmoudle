#!name=番茄小说
#!desc=彻底移除番茄小说开屏、贴片、听书页广告，保留封面/头像加载，避免误伤头条类 App。
#!author=zqzess & ChatGPT
#!icon=https://gitlab.com/lodepuly/iconlibrary/-/raw/main/App_icon/120px/DragonRead.png
#!category=广告屏蔽

[Rule]
# ✅ 广告视频域名与 mp4 链接
DOMAIN-REGEX,^v\d+-(reading-video|novelapp)\.fqnovelvod\.com$,REJECT
URL-REGEX,^https?:\/\/v\d+-(reading-video|novelapp)\.fqnovelvod\.com\/.+\.mp4,REJECT

# ✅ 广告图片 CDN 精准拦截
DOMAIN,p3-ad-sign.byteimg.com,REJECT
DOMAIN-KEYWORD,novel.byteimg.com,REJECT
URL-REGEX,^https?:\/\/.+\.byteimg\.com\/.+(ad|ad-img|ad-pattern).+\.jpeg,REJECT
URL-REGEX,^https?:\/\/.+\.byteimg\.com\/.+\/ad-pattern\/.+,REJECT

# ✅ fqnovelpic 精准封禁（保留正常图像）
URL-REGEX,^https?:\/\/.+\.fqnovelpic\.com\/.+\/ad\/.+,REJECT

# ✅ 广告接口与资源包
URL-REGEX,^http:\/\/sf3-be-pack\.pglstatp-toutiao\.com\/obj\/ad-app-package\/,REJECT
URL-REGEX,^https?:\/\/.+\.pangolin-sdk-toutiao.*\/api\/ad\/union\/sdk\/(get_ads|stats|settings)\/,REJECT
URL-REGEX,^https?:\/\/.+\.(pglstatp-toutiao|pstatp)\.com\/(obj|img)\/(ad-app-package|ad|web\.business\.image)\/.+,REJECT
URL-REGEX,^https?:\/\/.+\.pglstatp-toutiao\.com\/.+\/toutiao\.mp4,REJECT
URL-REGEX,^https?:\/\/.+\.pstatp\.com\/obj\/mosaic-legacy\/.+\?from=ad,REJECT
URL-REGEX,^https?:\/\/.+\.pstatp\.com\/bytecom\/resource\/track_log\/src\/.+,REJECT
URL-REGEX,^https?:\/\/gurd\.snssdk\.com\/src\/server\/v3\/package,REJECT
URL-REGEX,^https?:\/\/.+?\.snssdk\.com\/motor\/operation\/activity\/display\/config\/V2\/,REJECT
URL-REGEX,^https?:\/\/adim\.pinduoduo\.com\/.+\/toutiao\?.+,REJECT

# ✅ 域名关键词类广告监控
AND,((DOMAIN-KEYWORD, ads), (DOMAIN-KEYWORD, normal), (DOMAIN-SUFFIX, zijieapi.com)),REJECT
AND,((DOMAIN-KEYWORD, -ad-), (DOMAIN-SUFFIX, byteimg.com)),REJECT
AND,((DOMAIN-KEYWORD, minigame), (DOMAIN-SUFFIX, zijieapi.com)),REJECT
AND,((DOMAIN-KEYWORD, tnc), (AND, ((OR, ((DOMAIN-KEYWORD, -bjlgy), (DOMAIN-KEYWORD, -alisc), (DOMAIN-KEYWORD, -aliec))), (OR, ((DOMAIN-SUFFIX, snssdk.com), (DOMAIN-SUFFIX, toutiaoapi.com), (DOMAIN-SUFFIX, bytedance.com), (DOMAIN-SUFFIX, zijieapi.com)))))),REJECT

# ✅ 允许必要请求
DOMAIN,is.snssdk.com,DIRECT

# ✅ 广告 IP 拦截
IP-CIDR,49.71.37.101/32,REJECT,no-resolve
IP-CIDR,117.71.105.23/32,REJECT,no-resolve
IP-CIDR,218.94.207.205/32,REJECT,no-resolve
IP-CIDR,117.92.229.188/32,REJECT,no-resolve
IP-CIDR,101.36.166.16/32,REJECT,no-resolve
IP-CIDR,180.96.2.114/32,REJECT,no-resolve
# p3-ad-sign.byteimg.com 广告节点封锁（精准 IP 拦截）
IP-CIDR,47.246.38.177/32,REJECT,no-resolve
IP-CIDR,47.246.38.0/24,REJECT,no-resolve

[URL Rewrite]
^https:\/\/sf3-fe-tos\.pglstatp-toutiao\.com\/obj\/ad-pattern\/ reject header
^https:\/\/sf3-fe-tos\.pglstatp-toutiao\.com\/obj\/ad-pattern\/ reject
^https:\/\/lf-cdn-tos\.bytescm\.com\/obj\/static\/ad\/ reject
^https:\/\/tnc3-alisc1\.zijieapi\.com\/get_domains\/ reject

[MITM]
hostname = %APPEND% *.pangolin-sdk-toutiao,*.pstatp.com,*.pglstatp-toutiao.com,*.fqnovelvod.com,gurd.snssdk.com,adim.pinduoduo.com
