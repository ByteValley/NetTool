#!name=字节系净化
#!desc=按域名精细拦截字节系广告（蛋花 / 番茄 / 头条 / 抖音内嵌），屏蔽开屏 / 激励 / 前贴片及埋点，兼容短剧播放。
#!icon=https://gitlab.com/lodepuly/iconlibrary/-/raw/main/App_icon/120px/DragonRead.png
#!category=功能净化
#!author=ByteValley
#!version=2025-12-30R1

[Rule]
# =====================================================================
# 模块分类 · 直连放行（业务音频）
# 说明：
# · 汽水音乐部分音频流量需直连
# · 通过 -luna 线路标签识别
# =====================================================================
AND,((OR,((DOMAIN-SUFFIX,douyin.com),(DOMAIN-SUFFIX,douyinvod.com))),(DOMAIN-KEYWORD,-luna)),境内服务,extended-matching

# =====================================================================
# 模块分类 · 横幅广告（SDK 下标位）
# 说明：
# · ug-sdk 下标横幅与浮层广告
# · 不影响核心业务流程
# =====================================================================
AND,((DOMAIN-SUFFIX,ugsdk.cn),(DOMAIN-KEYWORD,-sinfonline)),REJECT-DROP,extended-matching

# =====================================================================
# 模块分类 · 短链 / 跳转追踪（落地页与归因）
# 说明：
# · bdurl / zjurl / byteurl 多用于广告跳转与归因
# · 不影响站内核心功能
# =====================================================================
DOMAIN-SUFFIX,bdurl.net,REJECT-DROP,extended-matching
DOMAIN-SUFFIX,zjurl.cn,REJECT-DROP,extended-matching
DOMAIN-SUFFIX,byteurl.cn,REJECT-DROP,extended-matching

# =====================================================================
# 模块分类 · 章节视频广告（推流源拦截 · 推荐）
# 说明：
# · 命中 douyincdn 的 stage 推流视频
# · 覆盖 flv / m3u8 / mp4 三种载体
# · 不影响章节正文与书城接口
# =====================================================================
URL-REGEX,^https?:\/\/[a-z0-9-]+\.douyincdn\.com\/stage\/stream-[^?]+\.(flv|m3u8|mp4)(\?|$),REJECT-DROP,extended-matching

# =====================================================================
# 模块分类 · 章节视频广告（上游调度拦截 · 高风险）
# 说明：
# · frontier-aweme / -bjlgy 常见于视频调度线路
# · 上游拦截命中高，但可能影响短剧或内嵌视频能力
# · 默认使用 REJECT，避免激进重试
# =====================================================================
AND,((DOMAIN-SUFFIX,snssdk.com),(OR,((DOMAIN-KEYWORD,frontier-aweme),(DOMAIN-KEYWORD,-bjlgy)))),REJECT-DROP,extended-matching

# =====================================================================
# 模块分类 · 章节视频广告（开放平台入口）
# 说明：
# · -open 线路常用于抖音开放能力调度
# · 可能影响分享 / 授权 / 拉起功能
# · 如出现异常可临时注释
# =====================================================================
AND,((DOMAIN-SUFFIX,douyin.com),(DOMAIN-KEYWORD,-open)),REJECT-DROP,extended-matching

# =====================================================================
# 模块分类 · 广告线路标签总闸（-lf / -lq / -hl）
# 说明：
# · 字节系常见广告 / 激励 / 前贴片线路标签
# · 通过域名 + 线路标签双条件命中
# · 默认使用 REJECT，优先保证稳定性
# =====================================================================
AND,((OR,((DOMAIN-SUFFIX,douyin.com),(DOMAIN-SUFFIX,zijieapi.com),(DOMAIN-SUFFIX,snssdk.com),(DOMAIN-SUFFIX,toutiaoapi.com),(DOMAIN-SUFFIX,fqnovel.com),(DOMAIN-SUFFIX,fqnovelvod.com))),(OR,((DOMAIN-KEYWORD,-lf),(DOMAIN-KEYWORD,-lq),(DOMAIN-KEYWORD,-hl)))),REJECT-DROP,extended-matching

# =====================================================================
# 模块分类 · 番茄小说短剧（TOS 推流视频）
# 说明：
# · 命中 bytegecko TOS 视频源
# · 仅拦推流，不影响信息流接口
# · 副作用：所有走该源的视频内容将无法播放
# =====================================================================
AND,((DOMAIN-SUFFIX,bytegecko.com),(DOMAIN-KEYWORD,-tos)),REJECT-DROP,extended-matching
