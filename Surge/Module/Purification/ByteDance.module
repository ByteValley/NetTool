#!name=字节系净化
#!desc=按域名精细拦截字节系广告（蛋花/番茄/头条/抖音内嵌），屏蔽开屏/激励/前贴片及埋点，兼容短剧播放，可通过「激励视频」参数调节拦截强度。
#!icon=https://gitlab.com/lodepuly/iconlibrary/-/raw/main/App_icon/120px/DragonRead.png
#!category=功能净化
#!author=ByteValley
#!version=2025-12-26R1
#!arguments=激励视频:REJECT-DROP

[MITM]
# 模块分类 · 证书与域名接管（仅重写/脚本需要）
# 说明：纯规则拦截无需 MITM；仅当你后续加入 Rewrite/Script 才启用
# hostname = %APPEND% *.toutiao.com

[Rule]
# 汽水音乐直连
AND,((OR,((DOMAIN-SUFFIX,douyin.com,extended-matching),(DOMAIN-SUFFIX,douyinvod.com,extended-matching))),(DOMAIN-KEYWORD,-luna,extended-matching)),DIRECT

# 下标横幅广告
AND,((DOMAIN-SUFFIX,ugsdk.cn,extended-matching),(DOMAIN-KEYWORD,-sinfonlineb,extended-matching)),REJECT-DROP

# —— 激励 / 前贴片媒体素材 ——
# AND,((DOMAIN-SUFFIX,bytedcdn.com),(DOMAIN-KEYWORD,reward-video)),REJECT-DROP,extended-matching
# AND,((DOMAIN-SUFFIX,snssdk.com),(DOMAIN-KEYWORD,toutiao-frontier)),REJECT-DROP,extended-matching

# =====================================================================
# 模块分类 · 广告线路标签总闸（-lf / -lq / -hl）
# =====================================================================
# 说明：
# · -lf / -lq / -hl 常见于字节系「线路标识」（load-balance / region / 机房）命名
# · 广告 / 激励 / 前贴片 / 埋点调度经常走这些线路，因此可作为“高命中总闸”
# · 风险：部分业务接口也可能带此类标签；若出现章节加载慢/书城空白/短剧异常，可临时注释本段排查
# · 行为：REJECT-DROP 更“硬”，能减少重试；如遇到卡顿可改为 REJECT
#
# 规则逻辑：
# · 命中域：douyin.com / zijieapi.com / snssdk.com / toutiaoapi.com / fqnovel.com
# · 命中关键字：-lf / -lq / -hl（任一出现即拦截）
AND,((OR,((DOMAIN-SUFFIX,douyin.com,extended-matching),(DOMAIN-SUFFIX,zijieapi.com,extended-matching),(DOMAIN-SUFFIX,snssdk.com,extended-matching),(DOMAIN-SUFFIX,toutiaoapi.com,extended-matching),(DOMAIN-SUFFIX,fqnovel.com,extended-matching))),(OR,((DOMAIN-KEYWORD,-lf,extended-matching),(DOMAIN-KEYWORD,-lq,extended-matching),(DOMAIN-KEYWORD,-hl,extended-matching)))),REJECT-DROP

# =====================================================================
# 模块分类 · 短链 / 跳转追踪域（落地页与归因）
# =====================================================================
# 说明：
# · bdurl / zjurl / byteurl 多用于站外跳转与归因追踪（广告投放/活动裂变常用）
# · i.snssdk.com 常作为跳转中转与落地页承载（部分活动页/推广链路会依赖）
# · 若你需要使用特定活动链接（例如邀请、裂变、兑换等）可按需注释对应行
DOMAIN-SUFFIX,bdurl.net,REJECT-DROP,extended-matching
DOMAIN-SUFFIX,zjurl.cn,REJECT-DROP,extended-matching
DOMAIN-SUFFIX,byteurl.cn,REJECT-DROP,extended-matching

# =====================================================================
# 番茄小说 · 章中短剧内容控制（推荐）
# =====================================================================
# DOMAIN,ib.snssdk.com,REJECT-DROP,extended-matching
# DOMAIN,i.snssdk.com,REJECT-DROP,extended-matching

# =====================================================================
# 番茄小说 · 章中短剧（仅拦推流视频源，避免误伤头条）
# =====================================================================
# 说明：
# · 章中短剧推流常走 lf-sourcecdn-tos.bytegecko.com（TOS 视频源）
# · 仅拦 sourcecdn 视频源：不影响头条信息流接口加载
# · 副作用：番茄内所有走该 sourcecdn 的视频内容都会无法播放（包括非短剧视频）
AND,((DOMAIN-SUFFIX,bytegecko.com,extended-matching),(DOMAIN-KEYWORD,-tos,extended-matching)),REJECT-DROP
