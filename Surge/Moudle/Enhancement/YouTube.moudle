#!name=YoutubeEnhance
#!desc=适用于 Youtube & Youtube Music
#!category=功能增强
#!arguments=屏蔽上传按钮:true,屏蔽选段按钮:true,屏蔽Shorts按钮:false,字幕翻译语言:off,歌词翻译语言:off,启用调试模式:false
#!arguments-desc=- 屏蔽参数：[true, false]\n- 翻译参数：[语言代码, off]\n\n1. 语言代码遵循 Google Translate Languages Codes, 当填入 off 时关闭翻译\n2. 开启调试模式用于输出更多日志

[Rule]
# —— 禁用 QUIC（可保留；与黑屏无直接因果） ——
AND,((DOMAIN-SUFFIX,googlevideo.com),(PROTOCOL,UDP)),REJECT
AND,((DOMAIN,youtubei.googleapis.com),(PROTOCOL,UDP)),REJECT

[Script]
# —— 关键接口脚本：PIP/后台/短视频/搜索/播放页等 —— 
# 如仍偶发黑屏，可把 binary-body-mode=1 改为 0 试试
YouTube后台播放 = type=http-response,pattern=^https:\/\/youtubei\.googleapis\.com\/(youtubei\/v1\/(browse|next|player|search|reel\/reel_watch_sequence|guide|account\/get_setting|get_watch))(\?(.*))?$,requires-body=1,max-size=-1,binary-body-mode=1,script-path=https://raw.githubusercontent.com/Maasea/sgmodule/master/Script/Youtube/youtube.response.js,argument="{\"lyricLang\":\"{{{歌词翻译语言}}}\",\"captionLang\":\"{{{字幕翻译语言}}}\",\"blockUpload\":{{{屏蔽上传按钮}}},\"blockImmersive\":{{{屏蔽选段按钮}}},\"blockShorts\":{{{屏蔽Shorts按钮}}},\"debug\":{{{启用调试模式}}}}"

[Map Local]
# —— 只拦真正的视频广告路径，避免误伤 initplayback/videoplayback —— 
^https?:\/\/[\w-]+\.googlevideo\.com\/dclk_video_ads[\/\?].* data-type=text data="" status-code=200

# —— 可选：通用广告/统计（非必要，但常用） ——
^https?:\/\/(www|s)\.youtube\.com\/api\/stats\/ads data-type=text data="" status-code=200
^https?:\/\/(www|s)\.youtube\.com\/(pagead|ptracking) data-type=text data="" status-code=200
^https?:\/\/s\.youtube\.com\/api\/stats\/qoe\?adcontext data-type=text data="" status-code=200

[MITM]
hostname = %APPEND% *.googlevideo.com, youtubei.googleapis.com
